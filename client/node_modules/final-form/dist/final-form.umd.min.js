!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e["final-form"]={})}(this,function(e){"use strict";function V(n){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{},t=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(t=t.concat(Object.getOwnPropertySymbols(a).filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable}))),t.forEach(function(e){var t,r,i;t=n,i=a[r=e],r in t?Object.defineProperty(t,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[r]=i})}return n}var u=function(e){if(null==e||!e.length)return[];if("string"!=typeof e)throw new Error("toPath() expects a string");return e.split(/[.[\]]+/).filter(Boolean)},N=function(e,t){for(var r=u(t),i=e,n=0;n<r.length;n++){var a=r[n];if(null==i||"object"!=typeof i||Array.isArray(i)&&isNaN(a))return;i=i[a]}return i},R=function(e,t,r){if(null==e)throw new Error("Cannot call setIn() with "+String(e)+" state");if(null==t)throw new Error("Cannot call setIn() with "+String(t)+" key");return function e(t,r,i,n){if(r>=i.length)return n;var a=i[r];if(isNaN(a)){var u;if(null==t){var o,s=e(void 0,r+1,i,n);return void 0===s?void 0:((o={})[a]=s,o)}if(Array.isArray(t))throw new Error("Cannot set a non-numeric property on an array");var l=e(t[a],r+1,i,n),c=Object.keys(t).length;if(void 0===l){if(void 0===t[a]&&0===c)return;if(void 0!==t[a]&&c<=1)return isNaN(i[r-1])?void 0:{}}return V({},t,((u={})[a]=l,u))}var f=Number(a);if(null==t){var d=e(void 0,r+1,i,n);if(void 0===d)return;var v=[];return v[f]=d,v}if(!Array.isArray(t))throw new Error("Cannot set a numeric property on an object");var b=e(t[f],r+1,i,n),m=t.concat();return m[f]=b,m}(e,0,u(t),r)},A="FINAL_FORM/form-error",P="FINAL_FORM/array-error",I=function(e,t){var r=e.errors,i=e.initialValues,n=e.lastSubmittedValues,a=e.submitErrors,u=e.submitFailed,o=e.submitSucceeded,s=e.values,l=t.active,c=t.blur,f=t.change,d=t.data,v=t.focus,b=t.name,m=t.touched,S=t.visited,h=N(s,b),y=N(r,b);y&&y[P]&&(y=y[P]);var g=a&&N(a,b),p=i&&N(i,b),E=t.isEqual(p,h),O=!y&&!g;return{active:l,blur:c,change:f,data:d,dirty:!E,dirtySinceLastSubmit:!(!n||t.isEqual(N(n,b),h)),error:y,focus:v,initial:p,invalid:!O,length:Array.isArray(h)?h.length:void 0,name:b,pristine:E,submitError:g,submitFailed:u,submitSucceeded:o,touched:m,valid:O,value:h,visited:S}},a=["active","data","dirty","dirtySinceLastSubmit","error","initial","invalid","length","pristine","submitError","submitFailed","submitSucceeded","touched","valid","value","visited"],x=function(e,t){if(e===t)return!0;if("object"!=typeof e||!e||"object"!=typeof t||!t)return!1;var r=Object.keys(e),i=Object.keys(t);if(r.length!==i.length)return!1;for(var n=Object.prototype.hasOwnProperty.bind(t),a=0;a<r.length;a++){var u=r[a];if(!n(u)||e[u]!==t[u])return!1}return!0};function o(t,r,i,n,e,a){var u=!1;return e.forEach(function(e){n[e]&&(t[e]=r[e],i&&(~a.indexOf(e)?x(r[e],i[e]):r[e]===i[e])||(u=!0))}),u}var s=["data"],L=function(e,t,r,i){var n={blur:e.blur,change:e.change,focus:e.focus,name:e.name};return o(n,e,t,r,a,s)||!t||i?n:void 0},l=["active","dirty","dirtySinceLastSubmit","error","errors","hasSubmitErrors","hasValidationErrors","initialValues","invalid","pristine","submitting","submitError","submitErrors","submitFailed","submitSucceeded","touched","valid","validating","values","visited"],c=["touched","visited"],q=function(e,t,r,i){var n={};return o(n,e,t,r,l,c)||!t||i?n:void 0},z=function(i){var n,a;return function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return n&&t.length===n.length&&!t.some(function(e,t){return!x(n[t],e)})||(n=t,a=i.apply(void 0,t)),a}},_=function(e){return!!e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof e.then},C=function(e,t){return e===t},B=function r(i){return Object.keys(i).some(function(e){var t=i[e];return t&&"object"==typeof t?r(t):void 0!==t})},D=function(e){var t=e.active,r=e.dirtySinceLastSubmit,i=e.error,n=e.errors,a=e.initialValues,u=e.pristine,o=e.submitting,s=e.submitFailed,l=e.submitSucceeded,c=e.submitError,f=e.submitErrors,d=e.valid,v=e.validating,b=e.values;return{active:t,dirty:!u,dirtySinceLastSubmit:r,error:i,errors:n,hasSubmitErrors:!!(c||f&&B(f)),hasValidationErrors:!(!i&&!B(n)),invalid:!d,initialValues:a,pristine:u,submitting:o,submitFailed:s,submitSucceeded:l,submitError:c,submitErrors:f,valid:d,validating:0<v,values:b}};function M(e,t,r,i,n,a){void 0===a&&(a=!1);var u=n(r,i,t,a);u&&e(u)}function U(e,i,n,a){var u=e.entries;Object.keys(u).forEach(function(e){var t=u[Number(e)],r=t.subscription;M(t.subscriber,r,i,n,a)})}e.createForm=function(e){if(!e)throw new Error("No config specified");e.debug;var o=e.destroyOnUnregister,a=e.keepDirtyOnReinitialize,t=e.initialValues,u=e.mutators,s=e.onSubmit,d=e.validate,n=e.validateOnBlur;if(!s)throw new Error("No onSubmit function specified");var v={subscribers:{index:0,entries:{}},fieldSubscribers:{},fields:{},formState:{dirtySinceLastSubmit:!1,errors:{},initialValues:t&&V({},t),invalid:!1,pristine:!0,submitting:!1,submitFailed:!1,submitSucceeded:!1,valid:!0,validating:0,values:t?V({},t):{}},lastFormState:void 0},i=!1,b=!1,m=!1,S=0,h={},y=function(t){return function(e){return delete h[t],e}},l=function(e,t,r){var i=r(N(e.formState.values,t));e.formState.values=R(e.formState.values,t,i)||{}},r=function(a){return function(){if(u){for(var e={formState:v.formState,fields:v.fields},t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];var n=u[a](r,e,{changeValue:l,getIn:N,setIn:R,shallowEqual:x});return v.formState=e.formState,v.fields=e.fields,f(void 0,function(){p(),j()}),n}}},c=u&&Object.keys(u).reduce(function(e,t){return e[t]=r(t),e},{})||{},g=function(i){return Object.keys(i.validators).reduce(function(e,t){var r=i.validators[Number(t)]();return r&&e.push(r),e},[])},f=function(e,t){if(b)return m=!0,void(t&&t());var s=v.fields,r=v.formState,i=Object.keys(s);if(d||i.some(function(e){return g(s[e]).length})){var o=!1;if(e){var n=s[e];if(n){var a=n.validateFields;a&&(o=!0,i=a.length?a.concat(e):[e])}}var l={},c={},u=function(e){var t=[];if(d){var r=d(V({},v.formState.values));if(_(r)){var i=S++,n=r.then(e).then(y(i));t.push(n),h[i]=n}else e(r)}return t}(function(e){l=e||{}}).concat(i.reduce(function(e,t){return e.concat((n=s[t],a=function(e){c[t]=e},o=[],(r=g(n)).length&&(r.forEach(function(e){var t=e(N(v.formState.values,n.name),v.formState.values);if(t&&_(t)){var r=S++,i=t.then(a).then(y(r));o.push(i),h[r]=i}else u||(u=t)}),a(u)),o));var n,a,u,o,r},[])),f=function(){var u=V({},o?r.errors:{},l),e=function(a){i.forEach(function(e){if(s[e]){var t=N(l,e),r=N(u,e),i=g(s[e]).length,n=c[e];a(e,i&&n||d&&t||(t||o?void 0:r))}})};e(function(e,t){u=R(u,e,t)||{}}),e(function(e,t){if(t&&t[P]){var r=N(u,e).concat();r[P]=t[P],u=R(u,e,r)}}),x(r.errors,u)||(r.errors=u),r.error=l[A]};f(),u.length?(v.formState.validating++,t&&t(),Promise.all(u).then(function(){v.formState.validating--,f(),t&&t()})):t&&t()}else t&&t()},p=function(e){if(!i&&!b){var n=v.fields,a=v.fieldSubscribers,u=v.formState;Object.keys(n).forEach(function(e){var t=n[e],r=I(u,t),i=t.lastFieldState;x(r,i)||(t.lastFieldState=r,U(a[e],r,i,L))})}},E=function(){Object.keys(v.fields).forEach(function(e){v.fields[e].touched=!0})},O=function(){var r=v.fields,t=v.formState,e=v.lastFormState,i=Object.keys(r);t.pristine=i.every(function(e){return r[e].isEqual(N(t.values,e),N(t.initialValues||{},e))}),t.dirtySinceLastSubmit=!(!t.lastSubmittedValues||i.every(function(e){return r[e].isEqual(N(t.values,e),N(t.lastSubmittedValues||{},e))})),t.valid=!(t.error||t.submitError||B(t.errors)||t.submitErrors&&B(t.submitErrors));var n=D(t),a=i.reduce(function(e,t){return e.touched[t]=r[t].touched,e.visited[t]=r[t].visited,e},{touched:{},visited:{}}),u=a.touched,o=a.visited;return n.touched=e&&x(e.touched,u)?e.touched:u,n.visited=e&&x(e.visited,o)?e.visited:o,e&&x(e,n)?e:n},F=!1,w=!1,j=function e(){if(F)w=!0;else{if(F=!0,!i&&!b){var t=v.lastFormState,r=O();r!==t&&(v.lastFormState=r,U(v.subscribers,r,t,q))}F=!1,w&&(w=!1,e())}};f();var k={batch:function(e){i=!0,e(),i=!1,p(),j()},blur:function(e){var t=v.fields,r=v.formState,i=t[e];i&&(delete r.active,t[e]=V({},i,{active:!1,touched:!0}),n?f(e,function(){p(),j()}):(p(),j()))},change:function(e,t){var r=v.formState;N(r.values,e)!==t&&(l(v,e,function(){return t}),n?(p(),j()):f(e,function(){p(),j()}))},focus:function(e){var t=v.fields[e];t&&!t.active&&(v.formState.active=e,t.active=!0,t.visited=!0,p(),j())},mutators:c,getFieldState:function(e){var t=v.fields[e];return t&&t.lastFieldState},getRegisteredFields:function(){return Object.keys(v.fields)},getState:function(){return D(v.formState)},initialize:function(r){var i=v.fields,n=v.formState;a||(n.values=r),Object.keys(i).forEach(function(e){var t=i[e];t.touched=!1,t.visited=!1,a&&i[e].isEqual(N(n.values,e),N(n.initialValues||{},e))&&(n.values=R(n.values,e,N(r,e)))}),n.initialValues=r,f(void 0,function(){p(),j()})},isValidationPaused:function(){return b},pauseValidation:function(){b=!0},registerField:function(t,r,i,e){void 0===i&&(i={}),v.fieldSubscribers[t]||(v.fieldSubscribers[t]={index:0,entries:{}});var n=v.fieldSubscribers[t].index++;if(v.fieldSubscribers[t].entries[n]={subscriber:z(r),subscription:i},!v.fields[t]){var a=v.formState.initialValues?N(v.formState.initialValues,t):void 0;v.fields[t]={active:!1,blur:function(){return k.blur(t)},change:function(e){return k.change(t,e)},data:{},focus:function(){return k.focus(t)},initial:a,isEqual:e&&e.isEqual||C,lastFieldState:void 0,name:t,touched:!1,valid:!0,validateFields:e&&e.validateFields,validators:{},visited:!1}}e&&e.getValidator&&(v.fields[t].validators[n]=e.getValidator);var u=!1;return f(void 0,function(){var e;j(),u||(e=I(v.formState,v.fields[t]),M(r,i,e,void 0,L,!0),v.fields[t].lastFieldState=e,u=!0),p()}),function(){delete v.fields[t].validators[n],delete v.fieldSubscribers[t].entries[n],Object.keys(v.fieldSubscribers[t].entries).length||(delete v.fieldSubscribers[t],delete v.fields[t],v.formState.errors=R(v.formState.errors,t,void 0)||{},o&&(v.formState.values=R(v.formState.values,t,void 0)||{})),f(void 0,function(){p(),j()})}},reset:function(e){void 0===e&&(e=v.formState.initialValues),v.formState.submitFailed=!1,v.formState.submitSucceeded=!1,delete v.formState.submitErrors,delete v.formState.lastSubmittedValues,k.initialize(e||{})},resumeValidation:function(){b=!1,m&&f(void 0,function(){p(),j()}),m=!1},setConfig:function(e,t){switch(e){case"debug":break;case"destroyOnUnregister":o=t;break;case"initialValues":k.initialize(t);break;case"keepDirtyOnReinitialize":a=t;break;case"mutators":(u=t)?(Object.keys(c).forEach(function(e){e in t||delete c[e]}),Object.keys(t).forEach(function(e){c[e]=r(e)})):Object.keys(c).forEach(function(e){delete c[e]});break;case"onSubmit":s=t;break;case"validate":d=t,f(void 0,function(){p(),j()});break;case"validateOnBlur":n=t;break;default:throw new Error("Unrecognised option "+e)}},submit:function(){var t=v.formState;if(v.formState.error||B(v.formState.errors))return E(),v.formState.submitFailed=!0,j(),void p();var e=Object.keys(h);if(e.length)Promise.all(e.reduce(function(e,t){return e.push(h[Number(t)]),e},[])).then(function(){return k.submit()});else{var r,i=!1,n=function(e){return t.submitting=!1,e&&B(e)?(t.submitFailed=!0,t.submitSucceeded=!1,t.submitErrors=e,t.submitError=e[A],E()):(delete t.submitErrors,delete t.submitError,t.submitFailed=!1,t.submitSucceeded=!0),j(),p(),i=!0,r&&r(e),e};if(t.submitting=!0,t.submitFailed=!1,t.submitSucceeded=!1,t.lastSubmittedValues=V({},t.values),3===s.length){if(s(t.values,k,n),!i)return j(),new Promise(function(e){r=e})}else{var a=s(t.values,k);if(a&&_(a))return j(),a.then(n);n(a)}}},subscribe:function(e,t){if(!e)throw new Error("No callback given.");if(!t)throw new Error("No subscription provided. What values do you want to listen to?");var r=z(e),i=v.subscribers,n=v.lastFormState,a=i.index++;i.entries[a]={subscriber:r,subscription:t};var u=O();return u!==n&&(v.lastFormState=u),M(r,t,u,u,q,!0),function(){delete i.entries[a]}}};return k},e.configOptions=["debug","initialValues","keepDirtyOnReinitialize","mutators","onSubmit","validate","validateOnBlur"],e.version="4.8.1",e.ARRAY_ERROR=P,e.FORM_ERROR=A,e.formSubscriptionItems=l,e.fieldSubscriptionItems=a,e.getIn=N,e.setIn=R,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=final-form.umd.min.js.map
